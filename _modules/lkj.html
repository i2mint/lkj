

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>lkj &mdash; lkj 0.1.45 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=ce72d79b"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/toggleprompt.js?v=d7ede5d2"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            lkj
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj.html">lkj</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/chunking.html">lkj.chunking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/dicts.html">lkj.dicts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/filesys.html">lkj.filesys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/funcs.html">lkj.funcs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/importing.html">lkj.importing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/iterables.html">lkj.iterables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/loggers.html">lkj.loggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/misc.html">lkj.misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_docs/lkj/strings.html">lkj.strings</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lkj</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">lkj</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for lkj</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Lightweight Kit Jumpstart</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.iterables</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">compare_sets</span><span class="p">,</span>  <span class="c1"># Compare two iterables and return common, left-only, and right-only elements</span>
    <span class="n">index_of</span><span class="p">,</span>  <span class="c1"># Get the index of an element in an iterable</span>
    <span class="n">get_by_value</span><span class="p">,</span>  <span class="c1"># Get a dictionary from a list of dictionaries by a field value</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.funcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">mk_factory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.dicts</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">truncate_dict_values</span><span class="p">,</span>  <span class="c1"># Truncate list and string values in a dictionary</span>
    <span class="n">inclusive_subdict</span><span class="p">,</span>  <span class="c1"># new dictionary with only the keys in `include`</span>
    <span class="n">exclusive_subdict</span><span class="p">,</span>  <span class="c1"># new dictionary with only the keys not in `exclude`.</span>
    <span class="n">merge_dicts</span><span class="p">,</span>  <span class="c1"># Merge multiple dictionaries recursively</span>
    <span class="n">compare_field_values</span><span class="p">,</span>  <span class="c1"># Compare two dictionaries&#39; values</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.filesys</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_app_data_dir</span><span class="p">,</span> <span class="n">get_watermarked_dir</span><span class="p">,</span> <span class="n">enable_sourcing_from_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.strings</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">print_list</span><span class="p">,</span>  <span class="c1"># Print a list in a nice format (or get a string to process yourself)</span>
    <span class="n">FindReplaceTool</span><span class="p">,</span>  <span class="c1"># Tool for finding and replacing substrings in a string</span>
    <span class="n">indent_lines</span><span class="p">,</span>  <span class="c1"># Indent all lines of a string</span>
    <span class="n">most_common_indent</span><span class="p">,</span>  <span class="c1"># Get the most common indent of a multiline string</span>
    <span class="n">regex_based_substitution</span><span class="p">,</span>
    <span class="n">truncate_string</span><span class="p">,</span>  <span class="c1"># Truncate a string to a maximum length, inserting a marker in the middle.</span>
    <span class="n">truncate_lines</span><span class="p">,</span>  <span class="c1"># Truncate a multiline string to a maximum number of lines</span>
    <span class="n">unique_affixes</span><span class="p">,</span>  <span class="c1"># Get unique prefixes or suffixes of a list of strings</span>
    <span class="n">camel_to_snake</span><span class="p">,</span>  <span class="c1"># Convert CamelCase to snake_case</span>
    <span class="n">snake_to_camel</span><span class="p">,</span>  <span class="c1"># Convert snake_case to CamelCase</span>
    <span class="n">fields_of_string_format</span><span class="p">,</span>  <span class="c1"># Extract field names from a string format</span>
    <span class="n">fields_of_string_formats</span><span class="p">,</span>  <span class="c1"># Extract field names from an iterable of string formats,</span>
    <span class="n">truncate_string_with_marker</span><span class="p">,</span>  <span class="c1"># Deprecated: Backcompatibility alias</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.loggers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">print_with_timestamp</span><span class="p">,</span>  <span class="c1"># Prints with a timestamp and optional refresh.</span>
    <span class="n">print_progress</span><span class="p">,</span>  <span class="c1"># an alias often used for print_with_timestamp</span>
    <span class="n">log_calls</span><span class="p">,</span>  <span class="c1"># Decorator that adds logging before and after the function&#39;s call.</span>
    <span class="n">clog</span><span class="p">,</span>  <span class="c1"># Conditional logger</span>
    <span class="n">ErrorInfo</span><span class="p">,</span>
    <span class="n">return_error_info_on_error</span><span class="p">,</span>  <span class="c1"># Decorator that returns traceback and local variables on error.</span>
    <span class="n">wrapped_print</span><span class="p">,</span>  <span class="c1"># Prints a string or list ensuring the total line width does not exceed `max_width`.</span>
    <span class="n">CallOnError</span><span class="p">,</span>  <span class="c1"># Context manager that calls a function on error (subclass of suppress)</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.importing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">parent_dir_of_module</span><span class="p">,</span>  <span class="c1"># Get the parent directory of a module</span>
    <span class="n">import_from_path</span><span class="p">,</span>  <span class="c1"># Import a module from a specified path</span>
    <span class="n">import_object</span><span class="p">,</span>  <span class="c1"># Import an object from a module by its name</span>
    <span class="n">register_namespace_forwarding</span><span class="p">,</span>  <span class="c1"># Register a namespace forwarding for a module</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.chunking</span><span class="w"> </span><span class="kn">import</span> <span class="n">chunk_iterable</span><span class="p">,</span> <span class="n">chunker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lkj.misc</span><span class="w"> </span><span class="kn">import</span> <span class="n">identity</span><span class="p">,</span> <span class="n">value_in_interval</span>

<span class="n">ddir</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">),</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)))</span>


<div class="viewcode-block" id="user_machine_id">
<a class="viewcode-back" href="../module_docs/lkj.html#lkj.user_machine_id">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">user_machine_id</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an ID for the current computer/user that calls this function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">__import__</span><span class="p">(</span><span class="s2">&quot;platform&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">node</span><span class="p">()</span></div>



<div class="viewcode-block" id="add_attr">
<a class="viewcode-back" href="../module_docs/lkj.html#lkj.add_attr">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_attr</span><span class="p">(</span><span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attr_val</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an attribute to an object.</span>

<span class="sd">    If no object is provided, return a partial function that takes an object as its</span>
<span class="sd">    argument.</span>
<span class="sd">    If no attribute value is provided, return a partial function that takes an</span>
<span class="sd">    attribute value as its argument.</span>
<span class="sd">    If no object or attribute value is provided, return a partial function that takes</span>
<span class="sd">    both an object and an attribute value as its arguments.</span>
<span class="sd">    If all arguments are provided, add the attribute to the object and return the</span>
<span class="sd">    object.</span>

<span class="sd">    :param attr_name: The name of the attribute to add.</span>
<span class="sd">    :param attr_val: The value of the attribute to add.</span>
<span class="sd">    :param obj: The object to which to add the attribute.</span>
<span class="sd">    :return: The object with the attribute added, or a partial function that takes an</span>
<span class="sd">    object and/or an attribute value as its argument(s).</span>

<span class="sd">    &gt;&gt;&gt; def generic_func(*args, **kwargs):</span>
<span class="sd">    ...     return args, kwargs</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; generic_func.__name__</span>
<span class="sd">    &#39;generic_func&#39;</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; _ = add_attr(&#39;__name__&#39;, &#39;my_func&#39;, generic_func);</span>
<span class="sd">    &gt;&gt;&gt; generic_func.__name__</span>
<span class="sd">    &#39;my_func&#39;</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; add_name = add_attr(&#39;__name__&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_doc = add_attr(&#39;__doc__&#39;)</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; @add_name(&#39;my_func&#39;)</span>
<span class="sd">    ... @add_doc(&#39;This is my function.&#39;)</span>
<span class="sd">    ... def f(*args, **kwargs):</span>
<span class="sd">    ...     return args, kwargs</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; f.__name__</span>
<span class="sd">    &#39;my_func&#39;</span>
<span class="sd">    &gt;&gt;&gt; f.__doc__</span>
<span class="sd">    &#39;This is my function.&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>

        <span class="k">if</span> <span class="n">attr_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">add_attr</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">add_attr</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_val</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attr_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span></div>



<div class="viewcode-block" id="add_as_attribute_of">
<a class="viewcode-back" href="../module_docs/lkj.html#lkj.add_as_attribute_of">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_as_attribute_of</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator that adds a function as an attribute of a container object ``obj``.</span>

<span class="sd">    If no ``name`` is given, the ``__name__`` of the function will be used, with a</span>
<span class="sd">    leading underscore removed. This is useful for adding helper functions to main</span>
<span class="sd">    &quot;container&quot; functions without polluting the namespace of the module, at least</span>
<span class="sd">    from the point of view of imports and tab completion.</span>

<span class="sd">    &gt;&gt;&gt; def foo():</span>
<span class="sd">    ...    pass</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; @add_as_attribute_of(foo)</span>
<span class="sd">    ... def helper():</span>
<span class="sd">    ...    pass</span>
<span class="sd">    &gt;&gt;&gt; hasattr(foo, &#39;helper&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; callable(foo.helper)</span>
<span class="sd">    True</span>

<span class="sd">    In reality, any object that has a ``__name__`` can be added to the attribute of</span>
<span class="sd">    ``obj``, but the intention is to add helper functions to main &quot;container&quot; functions.</span>

<span class="sd">    Note that if the name of the function starts with an underscore, it will be removed</span>
<span class="sd">    before adding it as an attribute of ``obj``.</span>

<span class="sd">    &gt;&gt;&gt; @add_as_attribute_of(foo)</span>
<span class="sd">    ... def _helper():</span>
<span class="sd">    ...    pass</span>
<span class="sd">    &gt;&gt;&gt; hasattr(foo, &#39;helper&#39;)</span>
<span class="sd">    True</span>

<span class="sd">    This is useful for adding helper functions to main &quot;container&quot; functions without</span>
<span class="sd">    polluting the namespace of the module, at least from the point of view of imports</span>
<span class="sd">    and tab completion. But if you really want to add a function with a leading</span>
<span class="sd">    underscore, you can do so by specifying the name explicitly:</span>

<span class="sd">    &gt;&gt;&gt; @add_as_attribute_of(foo, name=&#39;_helper&#39;)</span>
<span class="sd">    ... def _helper():</span>
<span class="sd">    ...    pass</span>
<span class="sd">    &gt;&gt;&gt; hasattr(foo, &#39;_helper&#39;)</span>
<span class="sd">    True</span>

<span class="sd">    Of course, you can give any name you want to the attribute:</span>

<span class="sd">    &gt;&gt;&gt; @add_as_attribute_of(foo, name=&#39;bar&#39;)</span>
<span class="sd">    ... def _helper():</span>
<span class="sd">    ...    pass</span>
<span class="sd">    &gt;&gt;&gt; hasattr(foo, &#39;bar&#39;)</span>
<span class="sd">    True</span>

<span class="sd">    :param obj: The object to which the function will be added as an attribute</span>
<span class="sd">    :param name: The name of the attribute to add the function to. If not given, the</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">attrname</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">attrname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
            <span class="n">attrname</span> <span class="o">=</span> <span class="n">attrname</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># remove leading underscore</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>

    <span class="k">return</span> <span class="n">_decorator</span></div>



<div class="viewcode-block" id="get_caller_package_name">
<a class="viewcode-back" href="../module_docs/lkj.html#lkj.get_caller_package_name">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_caller_package_name</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return package name of caller</span>

<span class="sd">    See: https://github.com/i2mint/i2mint/issues/1#issuecomment-1479416085</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="n">caller_frame</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">caller_frame</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>